# useEffect : Effet de bord

### üí° Comprendre le Hook useEffect

## üìù Tes notes

Detaille ce que tu as appris ici
`src/exercise/02.md`ou¬†sur¬†une¬†page¬†[Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Il arrive souvent que l'on ai des actions √† faire apr√®s le rendu finale du
composant (cf cycle de vie et hookflow). Par exemple modifier le DOM via, faire
des appel http vers des API etc ... On parle d'effet de bord.

```jsx
React.useEffect(() => {
  // Effet de board, appel APi Rest etc ...
})
```

Pour la d√©monstration imaginons que nous volons r√©cup√©rer la valeur d'un champs
input en JavaScript natif via l'api du navigateur, apr√®s tout avec React on peut
tout aussi bien faire du JavaScript natif.

```jsx
function Login() {
  const emailValue = document.getElementById('email').value
  // ‚ùå TypeError: Cannot read property 'value' of null
  return <input id="email" />
}
```

Cette exemple retourne une erreur :
`TypeError: Cannot read property 'value' of null`. Ce qui est normal car lorsque
React appelle `document.getElementById('email').value`. Le champ input n'est pas
encore cr√©√©, le rendu de la page n'est pas fini. Heureusement gr√¢ce √†
`useEffect` on peut ex√©cuter du code apr√®s le rendu.

```jsx
function Login() {
  React.useEffect(() => {
    const emailValue = document.getElementById('email').value
    // ‚úÖ La valeur est bien r√©cup√©r√©e
  })
  return <input id="email" />
}
```

üìë Le lien vers la doc
[useEffect](https://fr.reactjs.org/docs/hooks-effect.html)

## Exercice

Dans cet exercice il va falloir corriger l'erreur.

## Bonus

### 1. üöÄ D√©pendances d'effets

Dans cet exercice reprenons un exemple plus parlant comme celui de la section
pr√©c√©dente avec le stockage de l'email dans le `localstorage`. Stockons l'email
apr√®s chaque rendu.

```jsx
React.useEffect(() => {
  window.localStorage.setItem('email', email)
  console.log('useEffect localstorage email')
})
```

Rajoutons une champ input `password` et un state `password` et voyons ce qui se
passe.

```jsx
const [password, setPassword] = React.useState()
const handlePasswordChange = async event =>  setPassword(event.target.value)
...
<input value={password} onChange={handlePasswordChange} />
```

On constate qu'a chaque cycle, que ce soit pour l'email ou pour le `password`,
le `useEffect` se d√©clenche et fait un appel au `localstorage` (qui est une
op√©ration couteuse) . Nous voudrions d√©clencher `useEffect` uniquement lors du
changement d'√©tat du state `email`. Heureusement React nous permet de faire cela
gr√¢ce aux d√©pendances d'effets.

```jsx
const [name, setName] = React.useState()
React.useEffect(() => {
  //se d√©clanche uniquement quand name change de valeur via setName
}, [name])
```

Dans l'exercice il va falloir utiliser ce m√©canisme pour n'appeler l'appel au
`localstorage` qu'uniquement lorsque le state email change de valeur.

### 2. üöÄ D√©pendances d'effets sur props

Il est possible de d√©clencher l'effet sur un changement prop avec la m√™me
syntaxe. Pour illustrer ce cas nous allons mettre en place un changement de
props toutes les X secondes gr√¢ce √† `interval` . Le but ici n'est pas forcement
de comprendre ce que fait `interval` mais de voir comment cela se comporte quand
les props changent. Utilisons ce bout de code qui va faire √©voluer le prop
`initialEmail` toutes les X secondes.

```jsx
function App() {
  const [count, setCount] = React.useState(0)
  React.useEffect(() => {
    const interval = setInterval(() => {
      setCount(count => count + 1);
    }, 5000);
    return () => clearInterval(interval);
  }, []);
  return <Login initialEmail={`example-${count}@example.com`} />
```

Dans cet exercice il va falloir stocker dans le `localstorage` la valeur du prop
`initialEmail` uniquement lorsque ce dernier change.

## Aller plus loin

üìë Le lien vers la doc
[https://www.w3schools.com/html/html_css.asp](https://www.w3schools.com/html/html_css.asp)

## üêú Feedback

Remplir le formulaire le
[formulaire de FeedBack.](https://go.mikecodeur.com/cours-react-avis?entry.1430994900=React%20Hooks&entry.533578441=02%20useEffect%20:%20Effet%20de%20bord)
