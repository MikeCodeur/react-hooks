# useEffect : Appels HTTP avancÃ©s

### ğŸ’¡ useEffect : Appels HTTP avancÃ©s

## ğŸ“ Tes notes

Detaille ce que tu as appris ici
`src/exercise/08.md`ouÂ surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans cet section nous allons aller plus loin dans les appels HTTP avec
useEffect. Pour cela nous allons appeler l'API Marvel, pour simplifier les
exercice nous utiliserons une fonction toute prÃªte.

```jsx
import {fetchMarvel} from '../marvel'
fetchMarvel(marvelName).then(marvel => setMarvel(marvel))
```

## Exercice

Dans cet exercice il y a un champ input pour rechercher un personnage Marvel par
son nom et afficher le rÃ©sultat avec une photo et une liste d'Ã©pisodes dans
lequel le personnage apparait. Ces composants sont dÃ©jÃ  crÃ©Ã©s, il n'y a plus
qu'a les utiliser. Le but Ã©tant de se concentrer sur le `useEffect` et
`fetchMarvel.` ImplÃ©mente cela dans cet exercice.

## Bonus

### 1. ğŸš€ GÃ©rer les cas d'erreurs

Lorsque que l'on ne trouve pas de personnage Marvel, `fetchMarvel` lÃ¨ve un
Error. Dans cet exerice il va falloir gÃ©rer cet erreur en ajoutant un state
`error` et en rÃ©cupÃ©rant l'erreur de `fetchMarvel`.

```jsx
fetchMarvel(marvelName)
    .then(marvel => setMarvel(marvel))
    .catch(error => /* Met Ã  jour le state error ici*/)
```

Nous allons Ã©galement ajouter un div pour afficher le message d'erreur.

```jsx
return (
  <div style={{color: 'red'}}>
    Une erreur est survenue lors de la recherche de Marvel detail :{' '}
    {error.message}
  </div>
)
```

### 2. ğŸš€ PÃ©rimÃ¨tres d'erreurs (errors boundaries)

Dans le cycle de vie de React il y a la possibilitÃ© rÃ©cupÃ©rer des erreurs. Les 2
mÃ©thodes du cycles de vies sont :

- `getDerivedStateFromError` (permet d'attraper l'error)
- `componentDidCatch` (MÃ©thode appelÃ©e aprÃ¨s le catch)

Pour comprendre le mÃ©canisme d'erreur nous allons passer par une classe. La
technique consiste donc Ã  enrober (Wrapper) les composants Ã  gÃ©rer avec un
composant `ErrorBoundary` qui ressemble Ã  :

```jsx
class ErrorBoundary extends React.Component {
  state = {error: null};

  static getDerivedStateFromError(error) {
    return {error};
  }
  render() {
    if (this.state.error) {
      return <h1>Something went wrong.</h1>;
    }
    return this.props.children;
  }
}
//...
<ErrorBoundary>
	<Composant>
</ErrorBoundary>
```

ğŸ“‘ Lien vers la doc
[Error boundarie](https://fr.reactjs.org/docs/error-boundaries.html)

Dans cet exercice il va falloir crÃ©er un composant `ErrorBoundary`. Qui prend en
prop `ErrorDisplay` un composant d'affichage d'erreurs (extraire la div erreur
de l'exercice prÃ©cÃ¨dent)

### 3. ğŸš€ Relancer le pÃ©rimÃ¨tre d'erreur.

Le problÃ¨me de ce mÃ©canisme est qu'une fois le state `error` passer Ã  `true`, il
faut pouvoir le remettre Ã  false pour le pas afficher l'erreur indÃ©finiment. Un
simple technique consiste Ã  mettre une `key` unique pour force le composant a se
dÃ©monter et remonter (mount / unmount)

```jsx
<ErrorBoundary key={marvelName} ErrorDisplay={ErrorDisplay}>
  <MarvelDetails marvelName={marvelName} />
</ErrorBoundary>
```

### 4. ğŸš€ react-error-boundary package

Il existe un composant `ErrorBoundary` prÃªt Ã  l'utilisation

```jsx
import {ErrorBoundary} from 'react-error-boundary'
```

Utilise le dans cet exercice. ps : le `prop` s'appelle `FallbackComponent`

## ğŸœ Feedback

Remplir le formulaire le
[formulaire de FeedBack.](https://go.mikecodeur.com/cours-react-avis?entry.1430994900=React%20Hooks&entry.533578441=08%20useEffect%20:%20Appel%20HTTP%20avancÃ©)
